<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPL Player Performance</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tooltip {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            display: none;
            pointer-events: none;
        }

        .filters {
            margin-bottom: 20px;
        }

        .top-players {
            margin-top: 20px;
            text-align: left;
        }

        .chart-container {
            display: flex;
        }
    </style>
</head>

<body>
    <h2>IPL Player Performance Scatter Plot</h2>
    <div class="filters">
        <label for="teamFilter">Team:</label>
        <select id="teamFilter"></select>

        <label for="seasonFilter">Season:</label>
        <select id="seasonFilter"></select>
    </div>
    <div class="chart-container">
        <svg width="800" height="600"></svg>
        <div class="top-players">
            <h3>Top 5 Players</h3>
            <div id="player-list"></div>
        </div>
    </div>
    <div class="tooltip"></div>

    <script>
        const margin = { top: 50, right: 30, bottom: 50, left: 150 };
        const width = 800 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;

        const svg = d3.select("svg")
            .attr("width", 800)
            .attr("height", 600)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select(".tooltip");
        const teamFilter = d3.select("#teamFilter");
        const seasonFilter = d3.select("#seasonFilter");
        const playerList = d3.select("#player-list");

        d3.csv("IPL_data.csv").then(function (data) {
            data.forEach(d => {
                d.batting_score = +d.batting_score;
                d.bowling_score = +d.bowling_score;
                d.overall_score = +d.overall_score;
            });

            const teams = [...new Set(data.map(d => d.Team))];
            const seasons = [...new Set(data.map(d => d.Season))];

            teamFilter.append("option").text("All").attr("value", "All");
            teams.forEach(team => {
                teamFilter.append("option").text(team).attr("value", team);
            });

            seasonFilter.append("option").text("All").attr("value", "All");
            seasons.forEach(season => {
                seasonFilter.append("option").text(season).attr("value", season);
            });

            const orderedTypes = ["Overall Score", "Bowling Score", "Batting Score"];
            const typeToKey = {
                "Batting Score": "batting_score",
                "Bowling Score": "bowling_score",
                "Overall Score": "overall_score"
            };
            const colors = { "Batting Score": "#1f77b4", "Bowling Score": "#ff7f0e", "Overall Score": "#2ca02c" };

            function updateChart() {
                let filteredData = data;
                const selectedTeam = teamFilter.node().value;
                const selectedSeason = seasonFilter.node().value;

                if (selectedTeam !== "All") {
                    filteredData = filteredData.filter(d => d.Team === selectedTeam);
                }
                if (selectedSeason !== "All") {
                    filteredData = filteredData.filter(d => d.Season === selectedSeason);
                }

                let formattedData = [];
                let playerSummary = "";

                orderedTypes.forEach(label => {
                    const key = typeToKey[label];
                    let sortedPlayers = filteredData
                        .filter(d => !isNaN(d[key]))
                        .map(d => ({
                            player: d.Player,
                            type: label,
                            score: d[key]
                        }))
                        .sort((a, b) => b.score - a.score)
                        .slice(0, 5);

                    formattedData = formattedData.concat(sortedPlayers);
                });

                console.log({ formattedData });


                orderedTypes.forEach(label => {
                    playerSummary += `<h4>${label}</h4><ul>`;
                    formattedData
                        .filter(d => d.type === label)
                        .sort((a, b) => b.score - a.score)
                        .forEach((p, index) => {
                            playerSummary += `<li>${index + 1}. ${p.player}: ${p.score}</li>`;
                        });
                    playerSummary += "</ul>";
                });

                playerList.html(playerSummary);

                const xScale = d3.scaleLinear()
                    .domain([d3.min(formattedData, d => d.score) * 0.9 || 0, d3.max(formattedData, d => d.score) * 1.1 || 1000])
                    .range([0, width]);

                const yScale = d3.scalePoint()
                    .domain(orderedTypes.reverse())
                    .range([height, 0])
                    .padding(1);

                console.log({ orderedTypes, height });


                svg.selectAll("g.axis").remove();
                svg.append("g").attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(xScale).ticks(5));

                svg.append("g").attr("class", "axis")
                    .call(d3.axisLeft(yScale));

                let circles = svg.selectAll("circle").data(formattedData);
                circles.exit().remove();

                circles.enter()
                    .append("circle")
                    .merge(circles)
                    .attr("cx", d => xScale(d.score))
                    .attr("cy", d => yScale(d.type))
                    .attr("r", 12)
                    .attr("fill", d => colors[d.type])
                    .attr("opacity", 0.7);
            }

            teamFilter.on("change", updateChart);
            seasonFilter.on("change", updateChart);

            updateChart();
        });
    </script>
</body>

</html>